# chat.kv

<MessageBubble>:
    orientation: 'horizontal'
    size_hint_y: None
    height: self.minimum_height
    padding: '10sp', '5sp', '10sp', '5sp'
    spacing: '10sp'
    
    # Left spacer for user messages (right alignment)
    Widget:
        size_hint_x: 0.3 if root.is_user else 0
        width: 0 if not root.is_user else self.size_hint_x
    
    # Message container with bubble styling
    BoxLayout:
        id: message_container
        orientation: 'vertical'
        size_hint_y: None
        # size_hint_x: None
        size_hint_x: 0.7
        width: self.minimum_width
        height: '40sp'
        
        canvas.before:
            Color:
                rgba: (0.85, 0.92, 1, 1) if root.is_user else (0.95, 0.95, 0.95, 1)
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [15]
        
        # Padded container for content
        BoxLayout:
            padding: '15sp', '10sp', '15sp', '10sp'
            orientation: 'vertical'
            
            # Text content (always present)
            Label:
                id: message_label
                text: root.message_text
                font_size: '14sp'
                text_size: self.width, None
                halign: 'right' if root.is_user else 'left'
                valign: 'middle'
                color: 0.2, 0.2, 0.2, 1
                markup: True
                size_hint_y: None
                height: self.texture_size[1]
                opacity: 1 if root.message_type == "text" else 0.7
            
            # Image content (only for image messages)
            Image:
                source: root.image_source if root.message_type == "image" else ""
                size_hint_y: None
                height: '150sp' if root.message_type == "image" else 0
                opacity: 1 if root.message_type == "image" else 0
                allow_stretch: True
                keep_ratio: True
    
    # Right spacer for non-user messages (left alignment)  
    Widget:
        size_hint_x: 0.3 if not root.is_user else 0
        width: 0 if root.is_user else self.size_hint_x

<ChatHistory>:
    do_scroll_x: False
    do_scroll_y: True
    
    BoxLayout:
        id: messages_layout
        orientation: 'vertical'
        size_hint_y: None
        height: self.minimum_height
        spacing: '5sp'
        padding: '10sp', '10sp', '10sp', '10sp'

<MessageInput>:
    orientation: 'horizontal'
    size_hint_y: None
    height: '60sp'
    padding: '10sp', '10sp', '10sp', '10sp'
    spacing: '10sp'
    
    canvas.before:
        Color:
            rgba: 0.98, 0.98, 0.98, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [5]
    
    # Image upload button
    Button:
        text: 'ðŸ“·'
        size_hint_x: None
        width: '50sp'
        font_size: '20sp'
        background_color: 0.7, 0.7, 0.7, 1
        color: 1, 1, 1, 1
        on_press: root.open_image_chooser()
    
    TextInput:
        id: text_input
        multiline: True
        hint_text: 'Type a message...'
        font_size: '14sp'
        background_color: 1, 1, 1, 1
        foreground_color: 0.2, 0.2, 0.2, 1
        cursor_color: 0.3, 0.5, 0.8, 1
        size_hint_x: 0.7
        on_text_validate: root.on_enter_pressed(self)
    
    Button:
        text: 'Send'
        size_hint_x: 0.2
        font_size: '14sp'
        background_color: 0.3, 0.5, 0.8, 1
        color: 1, 1, 1, 1
        on_press: root.send_message()

<UrlInput>:
    orientation: 'horizontal'
    size_hint_y: None
    height: '50sp'
    padding: '10sp', '10sp', '10sp', '10sp'
    spacing: '10sp'
    
    canvas.before:
        Color:
            rgba: 0.9, 0.9, 0.9, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [2]
    
    TextInput:
        id: text_input
        multiline: False
        hint_text: 'Enter the URL'
        font_size: '14sp'
        background_color: 1, 1, 1, 1
        foreground_color: 0.2, 0.2, 0.2, 1
        cursor_color: 0.3, 0.5, 0.8, 1
        size_hint_x: 0.7
        on_text_validate: root.on_enter_pressed(self)
    

<ChatInterface>:
    orientation: 'vertical'
    
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [0]
    
    UrlInput:
        id: url_input

    # Header
    BoxLayout:
        size_hint_y: None
        height: '50sp'
        padding: '15sp', '10sp', '15sp', '10sp'
        
        canvas.before:
            Color:
                rgba: 0.9, 0.9, 0.9, 1
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [0]
        
        Label:
            text: 'Chat Interface'
            font_size: '18sp'
            color: 0.2, 0.2, 0.2, 1
            bold: True
    
    # Chat history
    ChatHistory:
        id: chat_history
    
    # Message input
    MessageInput:
        id: message_input

